'use client';

import React from 'react';
import { UserProfile } from '@/types';

interface StepProps {
    data: UserProfile;
    update: (section: keyof UserProfile, data: any) => void;
    onNext: () => void;
    onBack: () => void;
    canNext: boolean;
}

export default function FamilyVulnerabilityStep({ data, update, onNext, onBack, canNext }: StepProps) {
    return (
        <div className="p-8 flex-1 flex flex-col">
            <h2 className="text-2xl font-bold text-slate-900 mb-1">√âTAPE 4 : ATTACHES & VULN√âRABILIT√â</h2>
            <p className="text-slate-500 mb-8">L'Ancrage : Voir vos droits li√©s √† votre vie priv√©e, familiale et votre situation de sant√©.</p>

            <div className="space-y-6 mb-8">
                <div>
                    <label className="block text-sm font-semibold text-slate-700 mb-4 tracking-wide uppercase text-indigo-900">
                        Situation Matrimoniale <span className="text-red-500">*</span>
                    </label>
                    <div className="flex gap-4">
                        <button
                            onClick={() => update('family', { spouse_nationality: data.family.spouse_nationality === 'NONE' ? 'NON_EU' : data.family.spouse_nationality })}
                            className={`flex-1 py-4 px-4 rounded-xl border-2 font-bold transition-all flex items-center justify-center gap-2 ${data.family.spouse_nationality !== 'NONE' ? 'bg-indigo-600 text-white border-indigo-600 shadow-md ring-2 ring-indigo-200' : 'bg-white text-slate-500 border-slate-100 hover:border-slate-300'}`}
                        >
                            <span>üíç</span> En couple (Mari√©/Pacs√©)
                        </button>
                        <button
                            onClick={() => update('family', { spouse_nationality: 'NONE', marriage_duration_years: 0, community_of_life: false })}
                            className={`flex-1 py-4 px-4 rounded-xl border-2 font-bold transition-all flex items-center justify-center gap-2 ${data.family.spouse_nationality === 'NONE' ? 'bg-indigo-600 text-white border-indigo-600 shadow-md ring-2 ring-indigo-200' : 'bg-white text-slate-500 border-slate-100 hover:border-slate-300'}`}
                        >
                            <span>üë§</span> C√©libataire
                        </button>
                    </div>
                </div>

                {data.family.spouse_nationality !== 'NONE' && (
                    <div className="space-y-6 animate-in fade-in slide-in-from-top-4 duration-300 p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Nationalit√© du conjoint(e)</label>
                                <select
                                    value={data.family.spouse_nationality}
                                    onChange={(e) => update('family', { spouse_nationality: e.target.value })}
                                    className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all bg-white"
                                >
                                    <option value="FRENCH">Fran√ßaise</option>
                                    <option value="EU">Union Europ√©enne</option>
                                    <option value="NON_EU">Autre (Hors UE)</option>
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Dur√©e (ann√©es)</label>
                                <input
                                    type="number"
                                    value={data.family.marriage_duration_years}
                                    onChange={(e) => update('family', { marriage_duration_years: Number(e.target.value) || 0 })}
                                    className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                                />
                            </div>
                        </div>

                        <div className="flex items-center gap-3 p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                            <input
                                type="checkbox"
                                id="community_life"
                                checked={data.family.community_of_life}
                                onChange={(e) => update('family', { community_of_life: e.target.checked })}
                                className="w-5 h-5 text-indigo-600 rounded"
                            />
                            <label htmlFor="community_life" className="text-sm font-medium text-slate-700">
                                Communaut√© de vie effective (vie commune)
                            </label>
                        </div>
                    </div>
                )}

                <div className="space-y-4">
                    <label className="block text-sm font-semibold text-slate-700 mb-2 tracking-wide uppercase text-indigo-900">Enfants & Vuln√©rabilit√©</label>
                    <div className="grid grid-cols-1 gap-4">
                        <div className={`p-4 rounded-xl border-2 transition-all ${data.family.has_french_child ? 'bg-indigo-50 border-indigo-200' : 'bg-white border-slate-100'}`}>
                            <div className="flex items-center gap-3">
                                <input
                                    type="checkbox"
                                    id="has_children"
                                    checked={data.family.has_french_child} // Reusing has_french_child as a proxy for "I have children" in simplified UX if needed, or keeping logic
                                    onChange={(e) => update('family', { has_french_child: e.target.checked })}
                                    className="w-5 h-5 text-indigo-600 rounded"
                                />
                                <label htmlFor="has_children" className="text-sm font-bold text-slate-800">
                                    J'ai au moins un enfant fran√ßais mineur
                                </label>
                            </div>
                        </div>

                        <div className={`p-4 rounded-xl border-2 transition-all ${data.vulnerability.show_vulnerability ? 'bg-rose-50 border-rose-100' : 'bg-white border-slate-100'}`}>
                            <div className="flex items-center gap-3">
                                <input
                                    type="checkbox"
                                    id="vulnerability"
                                    checked={data.vulnerability.show_vulnerability}
                                    onChange={(e) => update('vulnerability', { show_vulnerability: e.target.checked })}
                                    className="w-5 h-5 text-rose-500 rounded"
                                />
                                <label htmlFor="vulnerability" className="text-sm font-bold text-slate-800">
                                    Je suis concern√©(e) par une situation de sant√© ou de violence
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div className="mt-auto flex justify-between">
                <button
                    onClick={onBack}
                    className="px-6 py-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 font-semibold rounded-lg transition-all duration-200"
                >
                    Pr√©c√©dent
                </button>
                <button
                    onClick={onNext}
                    disabled={!canNext}
                    className={`w-full md:w-auto px-8 py-3 font-semibold rounded-lg transition-all duration-200 ${canNext
                        ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg shadow-indigo-200'
                        : 'bg-slate-200 text-slate-400 cursor-not-allowed'
                        }`}
                >
                    Voir les R√©sultats
                </button>
            </div>
        </div>
    );
}
